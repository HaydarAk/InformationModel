@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix dct: <http://purl.org/dc/terms/> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix spin:    <http://spinrdf.org/spin#> .
@prefix ids: <https://w3id.org/idsa/core/> .
@prefix idsc: <https://w3id.org/idsa/code/> .
@prefix idsm: <https://w3id.org/idsa/metamodel/> .

# Instances
# ---------

idsc:UsageRequestAfterPaymentTemplate a ids:PolicyTemplate ;
    rdfs:label "Request for Usage After Payment Template" ;
    rdfs:comment "A template for policy requests which allow usage only after a certain payment occurred."@en ;
	spin:labelTemplate """The {?ProviderParticipantURI} asks to {?action element of [ids:use|ids:read|...]} 
		a {?content element of [<Representation URI>|<Artifact URI>]} from the {?ConsumerParticipantURI}
		only if {?price} has been payed and the {?PipURI} says so."""@en ;
    skos:note """{ 
		"@context": "https://w3id.org/idsa/context.json",
		"@type": "ContractRequest", 
		"@id": "{contractID}", 
		"refersTo": "https://w3id.org/idsa/code/policytemplate/UsageRequestAfterPaymentTemplate" ,
		"targetContent": "{?content}",
		"provider": "{?ProviderParticipantURI}",
		"consumer": "{?ConsumerParticipantURI}", 
		"permission": {
			"action": "{?action}"  ,
			"constraint" : {    
                 "leftOperand" : "idsc:PAY_AMOUNT",
                 "operator" : "idsc:EQ",
                 "rightOperandReference" : "{?PipURI}"
			}
		},
		"obligation": {
            "action": "idsc:COMPENSATE" ,
            "constraint" : {
                 "leftOperand" : "idsc:PAY_AMOUNT",
                 "operator" : "idsc:EQ",
                 "rightOperand" : {
                    "@value": "{?price}",
                    "ids:unit": {
                        "@id": "http://dbpedia.org/resource/Euro"
                    }
                 }
            }
		}
	}"""^^xsd:string ;
	skos:note """@prefix ids: <https://w3id.org/idsa/core/> .
		@prefix idsc: <https://w3id.org/idsa/code/> .
		@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
		@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
		@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

		{?contractID} a ids:ContractRequest ;
			ids:refersTo idsc:UsageRequestAfterPaymentTemplate ;
			ids:targetContent {?content} ;
			ids:consumer {?ConsumerParticipantURI} ;
			ids:provider {?ProviderParticipantURI} ;			
			ids:permission [
				ids:action {?action} ;
				ids:constraint [
					ids:leftOperand ids:payAmount ;
					ids:operator ids:eq ;
					ids:rightOperandReference {?PipURI}
				] ;
			ids:obligations [
				ids:action idsc_action:COMPENSATE ;
				ids:constraint [
					ids:leftOperand ids:payAmount ;
					ids:operator ids:eq ;
					ids:rightOperand {?price}
				]
			]
			]
		."""^^xsd:string 
	.



